(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{1263:(e,t,a)=>{Promise.resolve().then(a.bind(a,9809))},6046:(e,t,a)=>{"use strict";var o=a(6658);a.o(o,"usePathname")&&a.d(t,{usePathname:function(){return o.usePathname}}),a.o(o,"useRouter")&&a.d(t,{useRouter:function(){return o.useRouter}}),a.o(o,"useSearchParams")&&a.d(t,{useSearchParams:function(){return o.useSearchParams}})},9809:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>d});var o=a(5155),r=a(2115),s=a(6046),n=a(8435),c=a(183),i=a(7492),l=a(814);function d(){let{t:e,language:t}=(0,c.o)(),{user:a,isLoading:d}=(0,n.A)(),u=(0,s.useRouter)(),[m,g]=(0,r.useState)(!1),[h,p]=(0,r.useState)(null);(0,r.useEffect)(()=>{d||a||u.push("/login")},[a,d,u]);let x=async t=>{if(m)return;g(!0);let o=l.oR.loading(e("dashboard.capturingLocation"));if(!navigator.geolocation){g(!1),l.oR.error(e("dashboard.geoNotSupported"),{id:o});return}let r=e=>new Promise((t,a)=>{navigator.geolocation.getCurrentPosition(t,a,e)});try{let s;try{s=await r({enableHighAccuracy:!0,timeout:5e3,maximumAge:0})}catch(e){if(console.warn("High accuracy location failed, retrying with lower accuracy...",e),2===e.code||3===e.code)s=await r({enableHighAccuracy:!1,timeout:1e4,maximumAge:0});else throw e}let{latitude:n,longitude:c}=s.coords;p({lat:n,lng:c}),l.oR.loading(e("IN"===t?"dashboard.recordingClockIn":"dashboard.recordingClockOut"),{id:o});try{let r=await i.K.recordAttendance({username:a.username,type:t,latitude:n,longitude:c,userAgent:navigator.userAgent,deviceType:window.innerWidth<768?"mobile":"desktop"});r.success?l.oR.success(e("IN"===t?"dashboard.clockedInSuccess":"dashboard.clockedOutSuccess"),{id:o}):l.oR.error(r.message||e("dashboard.failedToRecord"),{id:o})}catch(t){l.oR.error(e("dashboard.serverError"),{id:o})}}catch(a){let t=a.message;1===a.code?t="Permission denied. Please enable location services in your browser and device settings.":2===a.code?t="Position unavailable. Please check your network connection or try moving to an open area.":3===a.code&&(t="Location request timed out. Please check your connection and try again."),l.oR.error(e("dashboard.locationError",{error:t}),{id:o})}finally{g(!1)}};return d||!a?null:(0,o.jsxs)("div",{className:"min-h-[calc(100vh-72px)] md:min-h-screen p-6 md:p-12 bg-[#f8fafe] font-sans",children:[(0,o.jsxs)("main",{className:"max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-12 gap-10 md:gap-12",children:[(0,o.jsxs)("header",{className:"lg:col-span-12 mb-2",children:[(0,o.jsx)("h1",{className:"text-3xl md:text-4xl font-black text-slate-900 tracking-tight",children:e("dashboard.welcome",{name:a.name})}),(0,o.jsx)("p",{className:"text-slate-400 text-lg font-medium mt-2",children:new Date().toLocaleDateString("zh-tw"===t?"zh-TW":"en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),(0,o.jsxs)("section",{className:"lg:col-span-7 bg-white p-8 md:p-12 rounded-[40px] shadow-[0_20px_60px_-15px_rgba(0,0,0,0.06)] border-none flex flex-col items-center justify-center space-y-12",children:[(0,o.jsxs)("div",{className:"text-center",children:[(0,o.jsx)("h2",{className:"text-3xl md:text-2xl font-bold text-slate-900 mb-2",children:e("dashboard.attendanceAction")}),(0,o.jsx)("p",{className:"text-slate-400 text-lg md:text-base font-medium",children:e("dashboard.capturedWithGps")})]}),(0,o.jsxs)("div",{className:"flex flex-col w-full gap-6",children:[(0,o.jsxs)("button",{onClick:()=>x("IN"),disabled:m,className:"group relative flex items-center justify-center gap-4 bg-[#5356FF] hover:bg-[#4346FF] text-white font-bold py-10 md:py-8 rounded-[32px] transition-all duration-300 transform active:scale-[0.98] disabled:opacity-50 shadow-xl shadow-indigo-100 disabled:cursor-not-allowed",children:[(0,o.jsx)("span",{className:"text-4xl md:text-3xl",children:"\uD83D\uDD52"}),(0,o.jsx)("span",{className:"text-2xl md:text-xl font-bold tracking-tight",children:m?e("common.loading"):e("dashboard.clockIn")})]}),(0,o.jsxs)("button",{onClick:()=>x("OUT"),disabled:m,className:"group relative flex items-center justify-center gap-4 bg-[#e11d48] hover:bg-[#be123c] text-white font-bold py-10 md:py-8 rounded-[32px] transition-all duration-300 transform active:scale-[0.98] disabled:opacity-50 shadow-xl shadow-rose-100 disabled:cursor-not-allowed",children:[(0,o.jsx)("span",{className:"text-4xl md:text-3xl",children:"⏳"}),(0,o.jsx)("span",{className:"text-2xl md:text-xl font-bold tracking-tight",children:m?e("common.loading"):e("dashboard.clockOut")})]})]})]}),(0,o.jsxs)("section",{className:"lg:col-span-5 space-y-10 md:space-y-8",children:[(0,o.jsxs)("div",{className:"bg-white p-8 md:p-10 rounded-[40px] shadow-[0_20px_60px_-15px_rgba(0,0,0,0.06)] border-none",children:[(0,o.jsx)("h3",{className:"text-xl md:text-lg font-bold text-slate-900 mb-8 md:mb-6",children:e("common.systemInfo")}),(0,o.jsxs)("div",{className:"space-y-6 md:space-y-4 text-lg md:text-sm",children:[(0,o.jsxs)("div",{className:"flex justify-between py-4 md:py-3 border-b border-slate-50",children:[(0,o.jsx)("span",{className:"text-slate-400 font-medium",children:e("dashboard.deviceDetected")}),(0,o.jsx)("span",{className:"font-bold text-slate-700 capitalize",children:window.innerWidth<768?"zh-tw"===t?"行動裝置":"Mobile":"zh-tw"===t?"電腦":"Desktop"})]}),(0,o.jsxs)("div",{className:"flex justify-between py-4 md:py-3 border-b border-slate-50",children:[(0,o.jsx)("span",{className:"text-slate-400 font-medium",children:e("dashboard.gpsStatus")}),(0,o.jsx)("span",{className:"font-bold ".concat(h?"text-green-500":"text-orange-400"),children:h?e("dashboard.active"):e("dashboard.awaitingPermission")})]}),h&&(0,o.jsxs)("div",{className:"text-xs text-slate-300 mt-4 font-mono bg-slate-50 p-2 rounded-lg",children:["LAT: ",h.lat.toFixed(6),", LNG: ",h.lng.toFixed(6)]})]})]}),(0,o.jsxs)("div",{className:"bg-gradient-to-br from-[#5356FF] to-[#4346FF] p-8 md:p-10 rounded-[40px] shadow-xl shadow-indigo-100 text-white relative overflow-hidden",children:[(0,o.jsx)("div",{className:"absolute -right-4 -top-4 text-90 opacity-10 rotate-12",children:"\uD83D\uDCCD"}),(0,o.jsx)("h3",{className:"text-xl md:text-lg font-bold mb-4 relative z-10",children:e("common.notice")}),(0,o.jsx)("p",{className:"text-lg md:text-sm font-medium opacity-90 leading-relaxed relative z-10",children:e("dashboard.noticeContent")})]})]})]}),(0,o.jsx)("footer",{className:"mt-16 pb-8 text-center text-slate-400 text-sm hidden md:block",children:(0,o.jsxs)("div",{className:"font-medium opacity-60",children:["\xa9 ",new Date().getFullYear()," ",e("common.appName"),". ",e("dashboard.allRightsReserved")]})})]})}},8435:(e,t,a)=>{"use strict";a.d(t,{A:()=>c,AuthProvider:()=>n});var o=a(5155),r=a(2115);let s=(0,r.createContext)(void 0),n=e=>{let{children:t}=e,[a,n]=(0,r.useState)(null),[c,i]=(0,r.useState)(!0);return(0,r.useEffect)(()=>{let e=localStorage.getItem("ehr_user");if(e)try{n(JSON.parse(e))}catch(e){localStorage.removeItem("ehr_user")}i(!1)},[]),(0,o.jsx)(s.Provider,{value:{user:a,login:e=>{n(e),localStorage.setItem("ehr_user",JSON.stringify(e))},logout:()=>{n(null),localStorage.removeItem("ehr_user")},isLoading:c},children:t})},c=()=>{let e=(0,r.useContext)(s);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},183:(e,t,a)=>{"use strict";a.d(t,{I:()=>c,o:()=>i});var o=a(5155),r=a(2115);let s={en:{common:{appName:"eHR System",signOut:"Sign Out",loading:"Loading...",error:"Error",success:"Success",notice:"Notice",systemInfo:"System Info"},login:{welcomeBack:"Welcome Back",signInToAccount:"Sign in to your eHR account",username:"Username",password:"Password",signIn:"Sign In",signingIn:"Signing in...",invalidCredentials:"Invalid credentials",connectionError:"Failed to connect to the server. Please check your connection and GAS URL.",needHelp:"Need help?",contactSupport:"Contact Support",managementSystem:"Management System",enterUsername:"Enter your username",enterPassword:"Enter your password"},dashboard:{welcome:"Welcome, {name}",role:"Role: {role}",attendanceAction:"Attendance Action",capturedWithGps:"Captured with GPS location",clockIn:"CLOCK IN",clockOut:"CLOCK OUT",capturingLocation:"Capturing location...",recordingClockIn:"Recording Clock In...",recordingClockOut:"Recording Clock Out...",clockedInSuccess:"Clocked in successfully!",clockedOutSuccess:"Clocked out successfully!",failedToRecord:"Failed to record attendance",serverError:"Server connection error. Check GAS URL.",locationError:"Location error: {error}. Please enable GPS.",geoNotSupported:"Geolocation is not supported by your browser",deviceDetected:"Device Detected",gpsStatus:"GPS Status",active:"Active",awaitingPermission:"Awaiting Permission",noticeContent:"Please ensure you are at the work location before clocking in. Your GPS coordinates are recorded for verification.",allRightsReserved:"All rights reserved."},profile:{title:"Edit Profile",name:"Name",newPassword:"New Password",confirmPassword:"Confirm New Password",save:"Save Changes",saving:"Saving...",success:"Profile updated successfully",passwordMismatch:"Passwords do not match",updateError:"Failed to update profile",defaultPasswordWarning:"Please change your default password to continue.",leaveBlank:"Leave blank to keep current password"}},"zh-tw":{common:{appName:"人事管理系統",signOut:"登出",loading:"載入中...",error:"錯誤",success:"成功",notice:"注意事項",systemInfo:"系統資訊"},login:{welcomeBack:"歡迎回來",signInToAccount:"請登入您的人事系統帳號",username:"使用者名稱",password:"密碼",signIn:"登入",signingIn:"登入中...",invalidCredentials:"帳號或密碼錯誤",connectionError:"連線伺服器失敗。請檢查您的網路連線與 GAS 網址。",needHelp:"需要幫助？",contactSupport:"聯繫支援",managementSystem:"管理系統",enterUsername:"請輸入使用者名稱",enterPassword:"請輸入密碼"},dashboard:{welcome:"歡迎，{name}",role:"角色：{role}",attendanceAction:"出勤操作",capturedWithGps:"將記錄 GPS 座標",clockIn:"上班打卡",clockOut:"下班打卡",capturingLocation:"正在取得位置...",recordingClockIn:"正在記錄上班時間...",recordingClockOut:"正在記錄下班時間...",clockedInSuccess:"上班打卡成功！",clockedOutSuccess:"下班打卡成功！",failedToRecord:"記錄出勤失敗",serverError:"伺服器連線錯誤。請檢查 GAS 網址。",locationError:"位置錯誤：{error}。請開啟 GPS。",geoNotSupported:"您的瀏覽器不支援地理位置功能",deviceDetected:"偵測裝置",gpsStatus:"GPS 狀態",active:"已啟用",awaitingPermission:"等待權限",noticeContent:"打卡前請確保您已到達工作地點。系統將會記錄您的 GPS 座標以便查核。",allRightsReserved:"版權所有。"},profile:{title:"編輯個人資料",name:"姓名",newPassword:"新密碼",confirmPassword:"確認新密碼",save:"儲存變更",saving:"儲存中...",success:"個人資料更新成功",passwordMismatch:"密碼不相符",updateError:"更新個人資料失敗",defaultPasswordWarning:"請更改預設密碼以繼續使用。",leaveBlank:"若不修改密碼請留空"}}},n=(0,r.createContext)(void 0),c=e=>{let{children:t}=e,[a,c]=(0,r.useState)("en");return(0,r.useEffect)(()=>{let e=localStorage.getItem("language");e&&("en"===e||"zh-tw"===e)?c(e):navigator.language.toLowerCase().startsWith("zh")&&c("zh-tw")},[]),(0,o.jsx)(n.Provider,{value:{language:a,setLanguage:e=>{c(e),localStorage.setItem("language",e)},t:(e,t)=>{let o=e.split("."),r=s[a];for(let t of o){if(void 0===r[t])return e;r=r[t]}return"string"==typeof r&&t&&Object.entries(t).forEach(e=>{let[t,a]=e;r=r.replace("{".concat(t,"}"),a)}),r}},children:t})},i=()=>{let e=(0,r.useContext)(n);if(void 0===e)throw Error("useLanguage must be used within a LanguageProvider");return e}},7492:(e,t,a)=>{"use strict";async function o(e){let t=new TextEncoder().encode(e);return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",t))).map(e=>e.toString(16).padStart(2,"0")).join("")}a.d(t,{K:()=>s});let r="https://script.google.com/macros/s/AKfycbzmxEOsly16LJr9Cc_lxRq9owKjDq2j1Z7BjhzxIP3BggbNEhoZmjqJldx4MJn65_ZU/exec",s={async login(e,t){let a=await o(t);return(await fetch(r,{method:"POST",mode:"cors",body:JSON.stringify({action:"login",username:e,password:a})})).json()},async updateProfile(e,t,a){let s={action:"updateUser",username:e,name:t};return a&&(s.password=await o(a)),(await fetch(r,{method:"POST",mode:"cors",body:JSON.stringify(s)})).json()},recordAttendance:async e=>(await fetch(r,{method:"POST",mode:"cors",body:JSON.stringify({action:"attendance",...e})})).json()}}},e=>{var t=t=>e(e.s=t);e.O(0,[814,441,517,358],()=>t(1263)),_N_E=e.O()}]);