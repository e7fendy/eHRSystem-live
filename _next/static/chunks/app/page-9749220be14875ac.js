(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{1263:(e,t,a)=>{Promise.resolve().then(a.bind(a,7988))},6889:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(7401).A)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]])},7988:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>x});var r=a(5155),o=a(2115),s=a(6046),d=a(8435),n=a(183),c=a(7492),l=a(814),i=a(3312),m=a(9749),h=a(6889);let u=(0,a(7401).A)("timer",[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]]);function x(){let{t:e,language:t}=(0,n.o)(),{user:a,isLoading:x}=(0,d.A)(),g=(0,s.useRouter)(),[b,p]=(0,o.useState)(!1),[y,f]=(0,o.useState)(null);(0,o.useEffect)(()=>{x||a||g.push("/login")},[a,x,g]);let w=async t=>{if(b)return;if("IN"===t){let t=new Date,a=60*t.getHours()+t.getMinutes();if(a<510||a>630){l.oR.error(e("dashboard.clockInThresholdError"));return}}p(!0);let r=l.oR.loading(e("dashboard.capturingLocation"));if(!navigator.geolocation){p(!1),l.oR.error(e("dashboard.geoNotSupported"),{id:r});return}let o=e=>new Promise((t,a)=>{navigator.geolocation.getCurrentPosition(t,a,e)});try{let s;try{s=await o({enableHighAccuracy:!0,timeout:5e3,maximumAge:0})}catch(e){if(console.warn("High accuracy location failed, retrying with lower accuracy...",e),2===e.code||3===e.code)s=await o({enableHighAccuracy:!1,timeout:1e4,maximumAge:0});else throw e}let{latitude:d,longitude:n}=s.coords;f({lat:d,lng:n}),l.oR.loading(e("IN"===t?"dashboard.recordingClockIn":"dashboard.recordingClockOut"),{id:r});try{let o=await c.K.recordAttendance({userId:a.userId,type:t,latitude:d,longitude:n,userAgent:navigator.userAgent,deviceType:window.innerWidth<768?"mobile":"desktop"});o.success?l.oR.success(e("IN"===t?"dashboard.clockedInSuccess":"dashboard.clockedOutSuccess"),{id:r}):l.oR.error(o.message||e("dashboard.failedToRecord"),{id:r})}catch(t){l.oR.error(e("dashboard.serverError"),{id:r})}}catch(a){let t=a.message;1===a.code?t="Permission denied. Please enable location services in your browser and device settings.":2===a.code?t="Position unavailable. Please check your network connection or try moving to an open area.":3===a.code&&(t="Location request timed out. Please check your connection and try again."),l.oR.error(e("dashboard.locationError",{error:t}),{id:r})}finally{p(!1)}};return x||!a?null:(0,r.jsxs)("div",{className:"min-h-[calc(100vh-72px)] md:min-h-screen p-6 md:p-12 bg-white md:bg-muted/30 font-sans",children:[(0,r.jsxs)("main",{className:"max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-12 gap-10 md:gap-12",children:[(0,r.jsxs)("header",{className:"lg:col-span-12 mb-6 md:mb-2",children:[(0,r.jsx)("h1",{className:"text-2xl md:text-4xl font-black tracking-tight text-center md:text-left",children:e("dashboard.welcome",{name:a.name})}),(0,r.jsx)("p",{className:"text-muted-foreground text-base md:text-lg font-medium mt-1 md:mt-2 text-center md:text-left",children:new Date().toLocaleDateString("zh-tw"===t?"zh-TW":"en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),(0,r.jsx)("section",{className:"lg:col-span-7 flex flex-col items-center justify-center space-y-8 md:space-y-12",children:(0,r.jsxs)("div",{className:"flex flex-col w-full gap-6",children:[(0,r.jsxs)(i.$,{onClick:()=>w("IN"),disabled:b,className:"group relative flex items-center justify-center gap-4 bg-primary hover:bg-primary/90 text-primary-foreground font-bold py-10 md:py-8 h-auto rounded-3xl shadow-xl shadow-primary/20 transition-all active:scale-[0.98]",children:[(0,r.jsx)(h.A,{className:"w-8 h-8 md:w-10 md:h-10"}),(0,r.jsx)("span",{className:"text-2xl md:text-xl font-bold tracking-tight",children:b?e("common.loading"):e("dashboard.clockIn")})]}),(0,r.jsxs)(i.$,{onClick:()=>w("OUT"),disabled:b,variant:"destructive",className:"group relative flex items-center justify-center gap-4 bg-destructive hover:bg-destructive/90 text-destructive-foreground font-bold py-10 md:py-8 h-auto rounded-3xl shadow-xl shadow-destructive/20 transition-all active:scale-[0.98]",children:[(0,r.jsx)(u,{className:"w-8 h-8 md:w-10 md:h-10"}),(0,r.jsx)("span",{className:"text-2xl md:text-xl font-bold tracking-tight",children:b?e("common.loading"):e("dashboard.clockOut")})]})]})}),(0,r.jsxs)("section",{className:"lg:col-span-5 space-y-10 md:space-y-8",children:[(0,r.jsxs)(m.Zp,{className:"rounded-3xl shadow-none border md:border-border",children:[(0,r.jsx)(m.aR,{children:(0,r.jsx)(m.ZB,{children:e("common.systemInfo")})}),(0,r.jsxs)(m.Wu,{className:"space-y-6 md:space-y-4",children:[(0,r.jsxs)("div",{className:"flex justify-between py-2 border-b",children:[(0,r.jsx)("span",{className:"text-muted-foreground font-medium",children:e("dashboard.deviceDetected")}),(0,r.jsx)("span",{className:"font-bold capitalize",children:window.innerWidth<768?"zh-tw"===t?"行動裝置":"Mobile":"zh-tw"===t?"電腦":"Desktop"})]}),(0,r.jsxs)("div",{className:"flex justify-between py-2 border-b border-border",children:[(0,r.jsx)("span",{className:"text-muted-foreground font-medium",children:e("dashboard.gpsStatus")}),(0,r.jsx)("span",{className:"font-bold ".concat(y?"text-green-500":"text-orange-400"),children:y?e("dashboard.active"):e("dashboard.awaitingPermission")})]}),y&&(0,r.jsxs)("div",{className:"text-xs text-muted-foreground mt-4 font-mono bg-muted p-2 rounded-lg",children:["LAT: ",y.lat.toFixed(6),", LNG: ",y.lng.toFixed(6)]})]})]}),(0,r.jsx)(m.Zp,{className:"bg-gradient-to-br from-primary to-primary/80 border-none text-primary-foreground rounded-3xl overflow-hidden relative shadow-xl shadow-primary/20",children:(0,r.jsxs)(m.Wu,{className:"p-8 md:p-10 relative z-10",children:[(0,r.jsx)("div",{className:"absolute -right-4 -top-4 text-9xl opacity-10 rotate-12 select-none",children:"\uD83D\uDCCD"}),(0,r.jsx)("h3",{className:"text-xl md:text-lg font-bold mb-4",children:e("common.notice")}),(0,r.jsx)("p",{className:"text-lg md:text-sm font-medium opacity-90 leading-relaxed",children:e("dashboard.noticeContent")})]})})]})]}),(0,r.jsx)("footer",{className:"mt-16 pb-8 text-center text-muted-foreground text-sm hidden md:block",children:(0,r.jsxs)("div",{className:"font-medium opacity-60",children:["\xa9 ",new Date().getFullYear()," ",e("common.appName"),". ",e("dashboard.allRightsReserved")]})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[882,814,802,441,517,358],()=>t(1263)),_N_E=e.O()}]);